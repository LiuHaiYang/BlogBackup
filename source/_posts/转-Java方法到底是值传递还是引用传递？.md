---
title: 转-Java方法到底是值传递还是引用传递？
date: 2020-09-16 18:46:17
tags: java
---

转自- !(https://cloud.tencent.com/developer/column/1697)

要点：Java方法到底是值传递还是引用传递？

这个问题一直在技术讨论区争论不休。对于初级人员来说很具有迷惑性，即便对于很多高级开发来说，也搞不清楚。
本篇文章就带大家探究一下底层的原理，最终化繁为简，让大家通过一两句话就明白到底是值传递还是引用传递。


### 值传递与引用传递
首先来了解一下值传递和引用传递的概念：

值传递（pass by value）是指在调用函数时将实际参数复制一份传递到函数中，在函数内对参数进行修改，不会影响到实际参数。

引用传递（pass by reference）是指在调用函数时将实际参数的地址直接传递到函数内，在函数内对参数所进行的修改，将影响到实际参数。

通过概念我们可以得出区分值传递和引用传递的本质区别就是：实际参数的值是复制了一份，还是直接拿去用了。

### 基础类型和String的传递过程
在此问题上经常有一个理解误区：值传递和引用传递区分的条件是传递的内容，如果是个值就是值传递。如果是个引用，就是引用传递。

注意，上面的理解是错误的，值传递和引用传递的表现形式貌似与对象类型有关，但本质上是无关的。

先来看一下基础类型和String类型通常在内存中存在的形式。更多展现形式我们在本系列文章的前几篇文章中已经多次提到。

![image](https://ask.qcloudimg.com/http-save/yehe-1161110/y8dye2iqxk.jpeg?imageView2/2/w/1620)


总结一下就是方法内基础类型的引用和值分配在栈中，String类型引用在栈中，值在堆（堆或字符串常量池）中。

先来看基础类型（以int为例）作为参数传递给方法时的内存结构：

此时可以看到方法内执行的赋值操作只是改变了str变量中存储的字符串的地址，并未影响到原有的name变量所指向的字符串。

以上是关于基础类型和String类的修改都符合值传递的要求：将实际参数复制一份，修改复制的参数值并不影响原有值。只不过针对String类型复制的实际值是变量中存储的引用地址。

有朋友说：不对啊，我传递进来一个对象，然后调用其set方法也可以修改对象的内容啊！

那么，我们再来看看引用类型的内存结构图。

### 引用类型的值传递
我们都知道数组也属于引用类型，但为了更加明确，我们这里新创建User对象来进行验证。

可以看出paramUser参数同样复制了user参数中的地址，因此也指向了堆中的User对象。那么，有朋友说User对象的确被改了啊！

需要注意的是，我们关注的不是对象内部的结构是否被改变，而是复制的原有的user参数的值是否被改变。从上图可以明显看出，原有的user中的值（引用地址），并没有发生任何改变。

那直接对paramUser赋值新对象会不会改变原有user变量的值？为了进一步验证，我们修改一下change方法中的内容：

在change方法执行之前，内存结构与上面的结构一样，但执行之后，内存结构便发生了新的变化。

如果是引用传递的话，那么对paramUser进行重新赋值，肯定会改变原有user对应的值。但这里很显然，赋值之后paramUser只是指向了一个新的堆中的对象，并未影响到原有的user值。

### 小结
通过上面的一步步分析和演示，我们可以很明显的看到出：如果是基础类型，那么在方法传递的时候复制的是（栈中）基础类型的引用和值，如果是引用类型复制的是（栈中）引用地址。

也就是说无论通过什么类型，最终都是进行了一份复制操作，而并不是直接传递实际值的引用传递。所以，在Java中本质上只有值传递，也就说Java的传参只会传递它的副本，并不会传递参数本身。